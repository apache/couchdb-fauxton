language: erlang
otp_release:
   - 17.4
git:
  depth: 10

services:
  - docker

sudo: true

addons:
  firefox: "38.0.1"
before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -qq flashplugin-installer

  - nvm install 4 && nvm use 4

  - docker run -d -p 5984:5984 klaemo/couchdb:2.0-dev --with-haproxy --admin=tester:testerpass
  - npm install

  - export DISPLAY=:99.0
  - "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1400x900x16"

before_script:
  - npm test
  - grunt debugDev
  - ./bin/fauxton &
  - sleep 30
script:
  - ./node_modules/grunt-cli/bin/grunt $COMMAND

cache: apt

env:
  matrix:
    - COMMAND=test
    - COMMAND=nightwatchtravis

git:
  depth: 1
